!function($){$.fn.jqte=function(e){var t=[{title:"Text Format"},{title:"Font Size"},{title:"Color"},{title:"Bold",hotkey:"B"},{title:"Italic",hotkey:"I"},{title:"Underline",hotkey:"U"},{title:"Ordered List",hotkey:"."},{title:"Unordered List",hotkey:","},{title:"Subscript",hotkey:"down arrow"},{title:"Superscript",hotkey:"up arrow"},{title:"Outdent",hotkey:"left arrow"},{title:"Indent",hotkey:"right arrow"},{title:"Justify Left"},{title:"Justify Center"},{title:"Justify Right"},{title:"Strike Through",hotkey:"K"},{title:"Add Link",hotkey:"L"},{title:"Remove Link"},{title:"Cleaner Style",hotkey:"Delete"},{title:"Horizontal Rule",hotkey:"H"},{title:"Source"}],s=[["p","Normal"],["h1","Header 1"],["h2","Header 2"],["h3","Header 3"],["h4","Header 4"],["h5","Header 5"],["h6","Header 6"],["pre","Preformatted"]],a=["10","12","16","18","20","24","28"],i=["0,0,0","68,68,68","102,102,102","153,153,153","204,204,204","238,238,238","243,243,243","255,255,255",null,"255,0,0","255,153,0","255,255,0","0,255,0","0,255,255","0,0,255","153,0,255","255,0,255",null,"244,204,204","252,229,205","255,242,204","217,234,211","208,224,227","207,226,243","217,210,233","234,209,220","234,153,153","249,203,156","255,229,153","182,215,168","162,196,201","159,197,232","180,167,214","213,166,189","224,102,102","246,178,107","255,217,102","147,196,125","118,165,175","111,168,220","142,124,195","194,123,160","204,0,0","230,145,56","241,194,50","106,168,79","69,129,142","61,133,198","103,78,167","166,77,121","153,0,0","180,95,6","191,144,0","56,118,29","19,79,92","11,83,148","53,28,117","116,27,71","102,0,0","120,63,4","127,96,0","39,78,19","12,52,61","7,55,99","32,18,77","76,17,48"],n=["Web Address","E-mail Address","Picture URL"],l=$.extend({status:!0,css:"jqte",title:!0,titletext:t,button:"OK",format:!0,formats:s,fsize:!0,fsizes:a,funit:"px",color:!0,linktypes:n,b:!0,i:!0,u:!0,ol:!0,ul:!0,sub:!0,sup:!0,outdent:!0,indent:!0,left:!0,center:!0,right:!0,strike:!0,link:!0,unlink:!0,remove:!0,rule:!0,source:!0,placeholder:!1,br:!0,p:!0,change:"",focus:"",blur:""},e);$.fn.jqteVal=function(e){$(this).closest("."+l.css).find("."+l.css+"_editor").html(e)};var o=navigator.userAgent.toLowerCase();/msie [1-7]./.test(o)&&(l.title=!1);var c=[];function r(e,t,s,a,i){var n=c.length+1;return c.push({name:e,cls:n,command:t,key:s,tag:a,emphasis:i})}return r("format","formats","","",!1),r("fsize","fSize","","",!1),r("color","colors","","",!1),r("b","Bold","B",["b","strong"],!0),r("i","Italic","I",["i","em"],!0),r("u","Underline","U",["u"],!0),r("ol","insertorderedlist","¾",["ol"],!0),r("ul","insertunorderedlist","¼",["ul"],!0),r("sub","subscript","(",["sub"],!0),r("sup","superscript","&",["sup"],!0),r("outdent","outdent","%",["blockquote"],!1),r("indent","indent","'",["blockquote"],!0),r("left","justifyLeft","","",!1),r("center","justifyCenter","","",!1),r("right","justifyRight","","",!1),r("strike","strikeThrough","K",["strike"],!0),r("link","linkcreator","L",["a"],!0),r("unlink","unlink","",["a"],!1),r("remove","removeformat",".","",!1),r("rule","inserthorizontalrule","H",["hr"],!1),r("source","displaysource","","",!1),this.each(function(){if($(this).data("jqte")&&null!=$(this).data("jqte")&&"undefined"!=$(this).data("jqte")?$(this).data("jqte",!1):$(this).data("jqte",!0),l.status&&$(this).data("jqte")){var e=$(this),t=$(this).prop("tagName").toLowerCase();$(this).attr("data-origin",t);var s=$(this).is("[value]")||"textarea"==t?$(this).val():$(this).html();s=s.replace(/&#34;/g,'"').replace(/&#39;/g,"'").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&"),$(this).after('<div class="'+l.css+'"></div>');var a=$(this).next("."+l.css);a.html('<div class="'+l.css+'_toolbar" role="toolbar" unselectable></div><div class="'+l.css+'_linkform" style="display:none" role="dialog"></div><div class="'+l.css+'_editor"></div>');var n=a.find("."+l.css+"_toolbar"),r=a.find("."+l.css+"_linkform"),d=a.find("."+l.css+"_editor"),u=l.css+"_tool_depressed";r.append('<div class="'+l.css+'_linktypeselect" unselectable></div><input class="'+l.css+'_linkinput" type="text/css" value=""><div class="'+l.css+'_linkbutton" unselectable>'+l.button+'</div> <div style="height:1px;float:none;clear:both"></div>');var f=r.find("."+l.css+"_linktypeselect"),h=r.find("."+l.css+"_linkinput"),m=r.find("."+l.css+"_linkbutton");f.append('<div class="'+l.css+'_linktypeview" unselectable></div><div class="'+l.css+'_linktypes" role="menu" unselectable></div>');var p=f.find("."+l.css+"_linktypes"),v=f.find("."+l.css+"_linktypeview"),g=l.css+"-setlink";d.after('<div class="'+l.css+"_source "+l.css+'_hiddenField"></div>');var y=a.find("."+l.css+"_source");if(e.appendTo(y),"textarea"!=t){ae="";$(e[0].attributes).each(function(){"type"!=this.nodeName&&"value"!=this.nodeName&&(ae=ae+" "+this.nodeName+'="'+this.nodeValue+'"')}),e.replaceWith("<textarea "+ae+">"+s+"</textarea>"),e=y.find("textarea")}d.attr("contenteditable","true").html(s);for(x=0;x<c.length;x++)if(l[c[x].name]){var _=c[x].key.length>0&&null!=l.titletext[x].hotkey&&"undefined"!=l.titletext[x].hotkey&&""!=l.titletext[x].hotkey?" (Ctrl+"+l.titletext[x].hotkey+")":"",k=null!=l.titletext[x].title&&"undefined"!=l.titletext[x].title&&""!=l.titletext[x].title?l.titletext[x].title+_:"";if(n.append('<div class="'+l.css+"_tool "+l.css+"_tool_"+c[x].cls+'" role="button" data-tool="'+x+'" unselectable><a class="'+l.css+'_tool_icon" unselectable></a></div>'),n.find("."+l.css+"_tool[data-tool="+x+"]").data({tag:c[x].tag,command:c[x].command,emphasis:c[x].emphasis,title:k}),"format"==c[x].name&&$.isArray(l.formats)){var b=l.formats[0][1].length>0&&"undefined"!=l.formats[0][1]?l.formats[0][1]:"";n.find("."+l.css+"_tool_"+c[x].cls).find("."+l.css+"_tool_icon").replaceWith('<a class="'+l.css+'_tool_label" unselectable><span class="'+l.css+'_tool_text" unselectable>'+b+'</span><span class="'+l.css+'_tool_icon" unselectable></span></a>'),n.find("."+l.css+"_tool_"+c[x].cls).append('<div class="'+l.css+'_formats" unselectable></div>');for(C=0;C<l.formats.length;C++)n.find("."+l.css+"_formats").append("<a "+l.css+'-formatval="'+l.formats[C][0]+'" class="'+l.css+"_format "+l.css+"_format_"+C+'" role="menuitem" unselectable>'+l.formats[C][1]+"</a>");n.find("."+l.css+"_formats").data("status",!1)}else if("fsize"==c[x].name&&$.isArray(l.fsizes)){n.find("."+l.css+"_tool_"+c[x].cls).append('<div class="'+l.css+'_fontsizes" unselectable></div>');for(var C=0;C<l.fsizes.length;C++)n.find("."+l.css+"_fontsizes").append("<a "+l.css+'-styleval="'+l.fsizes[C]+'" class="'+l.css+'_fontsize" style="font-size:'+l.fsizes[C]+l.funit+'" role="menuitem" unselectable>Abcdefgh...</a>')}else if("color"==c[x].name&&$.isArray(i)){n.find("."+l.css+"_tool_"+c[x].cls).append('<div class="'+l.css+'_cpalette" unselectable></div>');for(var w=0;w<i.length;w++)null!=i[w]?n.find("."+l.css+"_cpalette").append("<a "+l.css+'-styleval="'+i[w]+'" class="'+l.css+'_color" style="background-color: rgb('+i[w]+')" role="gridcell" unselectable></a>'):n.find("."+l.css+"_cpalette").append('<div class="'+l.css+'_colorSeperator"></div>')}}p.data("linktype","0");for(var x=0;x<3;x++)p.append("<a "+l.css+'-linktype="'+x+'" unselectable>'+l.linktypes[x]+"</a>"),v.html('<div class="'+l.css+'_linktypearrow" unselectable></div><div class="'+l.css+'_linktypetext">'+p.find("a:eq("+p.data("linktype")+")").text()+"</div>");var R="";if(R=/msie/.test(o)?"-ms-":/chrome/.test(o)||/safari/.test(o)||/yandex/.test(o)?"-webkit-":/mozilla/.test(o)?"-moz-":/opera/.test(o)?"-o-":/konqueror/.test(o)?"-khtml-":"",l.placeholder&&""!=l.placeholder){a.prepend('<div class="'+l.css+'_placeholder" unselectable><div class="'+l.css+'_placeholder_text">'+l.placeholder+"</div></div>");var A=a.find("."+l.css+"_placeholder");A.click(function(){d.focus()})}a.find("[unselectable]").css(R+"user-select","none").addClass("unselectable").attr("unselectable","on").on("selectstart mousedown",!1);var z=n.find("."+l.css+"_tool"),S=n.find("."+l.css+"_formats"),N=n.find("."+l.css+"_fontsizes"),F=n.find("."+l.css+"_cpalette");function O(){return window.getSelection?window.getSelection():document.selection&&document.selection.createRange&&"None"!=document.selection.type?document.selection.createRange():void 0}function T(e,t){var s,a=O();window.getSelection?(a.anchorNode&&a.getRangeAt&&(s=a.getRangeAt(0)),s&&(a.removeAllRanges(),a.addRange(s)),o.match(/msie/)||document.execCommand("StyleWithCSS",!1,!1),document.execCommand(e,!1,t)):document.selection&&document.selection.createRange&&"None"!=document.selection.type&&(s=document.selection.createRange()).execCommand(e,!1,t),j(!1,!1)}function q(e,t,s){if(d.not(":focus")&&d.focus(),window.getSelection){var a,i,n,l=O();l.anchorNode&&l.getRangeAt&&(a=l.getRangeAt(0),i=document.createElement(e),$(i).attr(t,s),n=a.extractContents(),i.appendChild(n),a.insertNode(i),l.removeAllRanges(),"style"==t?j($(i),s):j($(i),!1))}else if(document.selection&&document.selection.createRange&&"None"!=document.selection.type){var o="<"+e+" "+t+'="'+s+'">'+document.selection.createRange().htmlText+"</"+e+">";document.selection.createRange().pasteHTML(o)}}var L=function(){var e,t;if(window.getSelection&&(e=(t=getSelection()).anchorNode),!e&&document.selection&&document.selection.createRange&&"None"!=document.selection.type){var s=(t=document.selection).getRangeAt?t.getRangeAt(0):t.createRange();e=s.commonAncestorContainer?s.commonAncestorContainer:s.parentElement?s.parentElement():s.item(0)}return!!e&&$("#text"==e.nodeName?e.parentNode:e)};function j(e,t){var s=L();if((s=s||e)&&0==t)s.parent().is("[style]")&&s.attr("style",s.parent().attr("style")),s.is("[style]")&&s.find("*").attr("style",s.attr("style"));else if(e&&t&&e.is("[style]")){var a=t.split(";");a=a[0].split(":"),e.is("[style*="+a[0]+"]")&&e.find("*").css(a[0],a[1]),H(e)}}function H(e){if(e){var e=e[0];if(document.body.createTextRange)(s=document.body.createTextRange()).moveToElementText(e),s.select();else if(window.getSelection){var t=window.getSelection(),s=document.createRange();"undefined"!=e&&null!=e&&(s.selectNodeContents(e),t.removeAllRanges(),t.addRange(s),$(e).is(":empty")&&($(e).append("&nbsp;"),H($(e))))}}}function I(){if(n.data("sourceOpened"))W(!1);else{var e=L(),t="http://";W(!0),e?"a"==e.prop("tagName").toLowerCase()&&e.is("[href]")?(t=e.attr("href"),e.attr(g,"")):q("a",g,""):h.val(t).focus(),f.click(function(e){($(e.target).hasClass(l.css+"_linktypetext")||$(e.target).hasClass(l.css+"_linktypearrow"))&&D(!0)}),p.find("a").click(function(){var e=$(this).attr(l.css+"-linktype");p.data("linktype",e),v.find("."+l.css+"_linktypetext").html(p.find("a:eq("+p.data("linktype")+")").text()),B(t),D()}),B(t),h.focus().val(t).bind("keypress keyup",function(e){if(13==e.keyCode)return U(a.find("["+g+"]")),!1}),m.click(function(){U(a.find("["+g+"]"))})}}function U(e){h.focus(),H(e),e.removeAttr(g),"2"!=p.data("linktype")?T("createlink",h.val()):(T("insertImage",h.val()),d.find("img").each(function(){var e=$(this).prev("a"),t=$(this).next("a");e.length>0&&""==e.html()?e.remove():t.length>0&&""==t.html()&&t.remove()})),W(),d.trigger("change")}function W(e){K("["+g+"]:not([href])"),a.find("["+g+"][href]").removeAttr(g),e?(n.data("linkOpened",!0),r.show()):(n.data("linkOpened",!1),r.hide()),D()}function D(e){e?p.show():p.hide()}function B(e){var t=p.data("linktype");"1"!=t||"http://"!=h.val()&&!h.is("[value^=http://]")&&h.is("[value^=mailto]")?"1"==t||h.is("[value^=http://]")?h.val(e):h.val("http://"):h.val("mailto:")}function E(e){n.data("sourceOpened")?M(styleField,!1):("fSize"==e?styleField=N:"colors"==e&&(styleField=F),M(styleField,!0),styleField.find("a").unbind("click").click(function(){var t=$(this).attr(l.css+"-styleval");"fSize"==e?(styleType="font-size",t+=l.funit):"colors"==e&&(styleType="color",t="rgb("+t+")");var s=J(styleType);q("span","style",styleType+":"+t+";"+s),M("",!1),$("."+l.css+"_title").remove(),d.trigger("change")})),W(!1)}function M(e,t){var s="",a=[{d:"fsizeOpened",f:N},{d:"cpallOpened",f:F}];if(""!=e)for(i=0;i<a.length;i++)e==a[i].f&&(s=a[i]);if(t){n.data(s.d,!0),s.f.slideDown(100);for(i=0;i<a.length;i++)s.d!=a[i].d&&(n.data(a[i].d,!1),a[i].f.slideUp(100))}else for(var i=0;i<a.length;i++)n.data(a[i].d,!1),a[i].f.slideUp(100)}function K(e){a.find(e).each(function(){$(this).before($(this).html()).remove()})}function J(e){var t=L();if(t&&t.is("[style]")&&""!=t.css(e)){var s=t.css(e);t.css(e,"");var a=t.attr("style");return t.css(e,s),a}return""}function V(){P(!0),S.find("a").click(function(){$("*",this).click(function(e){return e.preventDefault(),!1}),Q($(this).text()),T("formatBlock","<"+$(this).attr(l.css+"-formatval")+">"),P(!1)})}function P(e){!(!e||!S.data("status"))||!e?S.data("status",!1).slideUp(200):S.data("status",!0).slideDown(200)}function Q(e){var t=S.closest("."+l.css+"_tool").find("."+l.css+"_tool_label").find("."+l.css+"_tool_text");e.length>10&&(e=e.substr(0,7)+"..."),t.html(e)}function G(e){var t,s,a;for(t=e.replace(/\n/gim,"").replace(/\r/gim,"").replace(/\t/gim,"").replace(/&nbsp;/gim," "),s=[/\<span(|\s+.*?)><span(|\s+.*?)>(.*?)<\/span><\/span>/gim,/<(\w*[^p])\s*[^\/>]*>\s*<\/\1>/gim,/\<div(|\s+.*?)>(.*?)\<\/div>/gim,/\<strong(|\s+.*?)>(.*?)\<\/strong>/gim,/\<em(|\s+.*?)>(.*?)\<\/em>/gim],a=["<span$2>$3</span>","","<p$1>$2</p>","<b$1>$2</b>","<i$1>$2</i>"],w=0;w<5;w++)for(i=0;i<s.length;i++)t=t.replace(s[i],a[i]);if(l.p||(t=t.replace(/\<p(|\s+.*?)>(.*?)\<\/p>/gi,"<br/>$2")),!l.br){s=[/\<br>(.*?)/gi,/\<br\/>(.*?)/gi],a=["<p>$1</p>","<p>$1</p>"];for(var i=0;i<s.length;i++)t=t.replace(s[i],a[i])}return l.p||l.br||(t=t.replace(/\<p>(.*?)\<\/p>/gi,"<div>$1</div>")),t}function X(){var t=""==d.text()&&d.html().length<12?"":d.html();e.val(G(t))}function Y(){d.html(G(e.val()))}function Z(e){var t,s=!1,a=L();return!!a&&($.each(e,function(e,i){(t=a.prop("tagName").toLowerCase())==i?s=!0:a.parents().each(function(){(t=$(this).prop("tagName").toLowerCase())==i&&(s=!0)})}),s)}function ee(e){for(var t=0;t<c.length;t++)l[c[t].name]&&c[t].emphasis&&""!=c[t].tag&&(Z(c[t].tag)?n.find("."+l.css+"_tool_"+c[t].cls).addClass(u):$("."+l.css+"_tool_"+c[t].cls).removeClass(u));if(l.format&&$.isArray(l.formats)){for(var s=!1,a=0;a<l.formats.length;a++){var i=[];if(i[0]=l.formats[a][0],l.formats[a][0].length>0&&Z(i)){Q(l.formats[a][1]),s=!0;break}}s||Q(l.formats[0][1])}M("",!1),P(!1)}z.unbind("click").click(function(t){"displaysource"!=$(this).data("command")||n.data("sourceOpened")?(n.data("sourceOpened")?(n.data("sourceOpened",!1),n.find("."+l.css+"_tool").removeClass(l.css+"_hiddenField"),y.addClass(l.css+"_hiddenField"),d.removeClass(l.css+"_hiddenField")):"linkcreator"==$(this).data("command")?n.data("linkOpened")?(W(!1),P(!1)):I():"formats"==$(this).data("command")?("formats"!=$(this).data("command")||$(t.target).hasClass(l.css+"_format")||V(),M("",!1),d.not(":focus")&&d.focus()):"fSize"==$(this).data("command")||"colors"==$(this).data("command")?(("fSize"==$(this).data("command")&&!$(t.target).hasClass(l.css+"_fontsize")||"colors"==$(this).data("command")&&!$(t.target).hasClass(l.css+"_color"))&&E($(this).data("command")),P(!1),d.not(":focus")&&d.focus()):(d.not(":focus")&&d.focus(),T($(this).data("command"),null),M("",!1),P(!1),D(),1!=$(this).data("emphasis")||$(this).hasClass(u)?$(this).removeClass(u):$(this).addClass(u),y.addClass(l.css+"_hiddenField"),d.removeClass(l.css+"_hiddenField")),l.placeholder&&""!=l.placeholder&&(""!=d.html()?A.hide():A.show())):(n.find("."+l.css+"_tool").addClass(l.css+"_hiddenField"),$(this).removeClass(l.css+"_hiddenField"),n.data("sourceOpened",!0),e.css("height",d.outerHeight()),y.removeClass(l.css+"_hiddenField"),d.addClass(l.css+"_hiddenField"),e.focus(),W(!1),M("",!1),P(),l.placeholder&&""!=l.placeholder&&A.hide()),d.trigger("change")}).hover(function(e){if(l.title&&""!=$(this).data("title")&&($(e.target).hasClass(l.css+"_tool")||$(e.target).hasClass(l.css+"_tool_icon"))){$("."+l.css+"_title").remove(),a.append('<div class="'+l.css+'_title"><div class="'+l.css+'_titleArrow"><div class="'+l.css+'_titleArrowIcon"></div></div><div class="'+l.css+'_titleText">'+$(this).data("title")+"</div></div>");var t=$("."+l.css+"_title:first"),s=(t.find("."+l.css+"_titleArrowIcon"),$(this).position()),i=s.left+$(this).outerWidth()-t.outerWidth()/2-$(this).outerWidth()/2,n=s.top+$(this).outerHeight()+5;t.delay(400).css({top:n,left:i}).fadeIn(200)}},function(){$("."+l.css+"_title").remove()});var te=null;d.bind("keypress keyup keydown drop cut copy paste DOMCharacterDataModified DOMSubtreeModified",function(){n.data("sourceOpened")||$(this).trigger("change"),D(),$.isFunction(l.change)&&l.change(),l.placeholder&&""!=l.placeholder&&(""!=$(this).text()?A.hide():A.show())}).bind("change",function(){n.data("sourceOpened")||(clearTimeout(te),te=setTimeout(X,10))}).keydown(function(e){if(e.ctrlKey)for(var t=0;t<c.length;t++)if(l[c[t].name]&&e.keyCode==c[t].key.charCodeAt(0))return""!=c[t].command&&"linkcreator"!=c[t].command?T(c[t].command,null):"linkcreator"==c[t].command&&I(),!1}).bind("mouseup keyup",ee).focus(function(){if($.isFunction(l.focus)&&l.focus(),a.addClass(l.css+"_focused"),/opera/.test(o)){var e=document.createRange();e.selectNodeContents(d[0]),e.collapse(!1);var t=window.getSelection();t.removeAllRanges(),t.addRange(e)}}).focusout(function(){z.removeClass(u),M("",!1),P(!1),D(),$.isFunction(l.blur)&&l.blur(),a.removeClass(l.css+"_focused"),$.isArray(l.formats)&&Q(l.formats[0][1])}),e.bind("keydown keyup",function(){setTimeout(Y,0),$(this).height($(this)[0].scrollHeight),""==$(this).val()&&$(this).height(0)}).focus(function(){a.addClass(l.css+"_focused")}).focusout(function(){a.removeClass(l.css+"_focused")})}else if($(this).closest("."+l.css).length>0){var se=$(this).closest("."+l.css).find("."+l.css+"_editor").html(),ae="";$($(this)[0].attributes).each(function(){"style"!=this.nodeName&&(ae=ae+" "+this.nodeName+'="'+this.nodeValue+'"')});var ie=">"+se;"input"!=(t=$(this).is("[data-origin]")&&""!=$(this).attr("data-origin")?$(this).attr("data-origin"):"textarea")&&"option"!=t||(ie='value="'+(se=se.replace(/"/g,"&#34;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;"))+'">');var ne=$(this).clone();$(this).data("jqte",!1).closest("."+l.css).before(ne).remove(),ne.replaceWith("<"+t+ae+ie+"</"+t+">")}})}}(jQuery);